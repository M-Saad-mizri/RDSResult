<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Development Program</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
    
        h3 {
            text-align: center;
            font-size: 1.2em; /* Adjusted for responsiveness */
            margin-top: 20px;
        }
    
        .container {
            width: 90%; /* Updated for better responsiveness */
            max-width: 1200px; /* Maximum width for larger screens */
            margin: 0 auto;
            padding: 20px;
        }
    
        #statistics {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
    
        table th, table td {
            padding: 12px; /* Increased padding for better readability */
            border: 1px solid #ddd;
            text-align: left;
            font-size: 0.9em; /* Adjusted font size for better visibility on smaller screens */
        }
    
        table th {
            background-color: #4CAF50;
            color: white;
        }
    
        select {
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1em; /* Responsive font size */
        }
    
        #loader {
            text-align: center;
            display: none;
            margin-top: 20px;
            font-size: 18px;
            color: #333;
        }
    
        /* Media Queries for smaller devices */
        @media (max-width: 768px) {
            h3 {
                font-size: 1em; /* Adjust for smaller screens */
            }
    
            .container {
                width: 95%;
                padding: 15px;
            }
    
            table th, table td {
                padding: 10px;
                font-size: 0.85em; /* Smaller font size for mobile devices */
            }
    
            select {
                width: 100%; /* Make dropdown take full width */
                font-size: 1em;
            }
        }
    
        @media (max-width: 480px) {
            h3 {
                font-size: 0.9em;
            }
    
            .container {
                width: 100%;
                padding: 10px;
            }
    
            table th, table td {
                padding: 8px;
                font-size: 0.75em; /* Smaller font size for mobile phones */
            }
    
            select {
                width: 100%; /* Ensure full-width dropdown on small devices */
                font-size: 0.9em;
            }
        }
    </style>
    
</head>
<body>

    <h3>
        CHIEF MINISTER SKILL DEVELOPMENT AND OVERSEAS EMPLOYMENT PROGRAM | <br>
        RECOMMENDED CANDIDATES FOR IT / HEALTH CARE / HOSPITALITY SECTOR AT EU / GERMANY BY <br>
        RADIUS CONSULTANT
    </h3>

    <div class="container">
        <h2>Overall Statistics</h2>
        <div id="statistics">
            <p><strong>Total Students:</strong> <span id="totalStudents">0</span></p>
            <p><strong>Pass (50 and above):</strong> <span id="passCount">0</span></p>
            <p><strong>Fail (below 50):</strong> <span id="failCount">0</span></p>
        </div>

        <h1>Filter Data by District and Field</h1>

        <label for="district">Select District:</label>
        <select id="district" onchange="filterData()">
            <option value="">All Districts</option>
        </select>

        <label for="field">Select Field:</label>
        <select id="field" onchange="filterData()">
            <option value="">All Fields</option>
            <option value="IT">IT</option>
            <option value="Health Care">Health Care</option>
            <option value="Hospitality">Hospitality</option>
        </select>

        <div id="loader">Loading...</div>

        <div id="resultTable"></div>
    </div>

    <script>
        let studentData = []; // Store the fetched data

        // Fetch data on page load
        window.onload = function() {
            fetchData();
        };

        // Function to fetch data from API
        function fetchData() {
            document.getElementById('loader').style.display = 'block'; // Show loader

            fetch('https://script.google.com/macros/s/AKfycbwIOjxTdxzCgqNYfPhi4o3rYLDijtxnUWw4jhnZAZ3tFZTkvNZ5KYd8dG39KMmmMmue/exec')
                .then(response => response.json())
                .then(data => {
                    studentData = data;
                    populateTable(studentData); // Populate table with all data
                    updateStatistics(studentData); // Update overall statistics
                    populateDistricts(studentData); // Populate district dropdown
                    document.getElementById('loader').style.display = 'none'; // Hide loader
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    document.getElementById('loader').style.display = 'none'; // Hide loader
                });
        }

        // Function to update statistics
        function updateStatistics(data) {
            const totalStudents = data.length;
            const passCount = data.filter(row => row[7] >= 50).length; // Assuming column 7 is the final score
            const failCount = totalStudents - passCount;

            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
        }

        // Function to populate the result table
        function populateTable(data) {
            const table = document.getElementById('resultTable');
            table.innerHTML = ''; // Clear the table before adding new data

            const header = `
                <table>
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Father Name</th>
                            <th>CNIC</th>
                            <th>District</th>
                            <th>Field</th>
                            <th>MCQs Score</th>
                            <th>Essay Score</th>
                            <th>Final Score</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            table.innerHTML += header;

            // Populate table rows
            data.forEach(row => {
                const rowHTML = `
                    <tr>
                        <td>${row[0]}</td>
                        <td>${row[1]}</td>
                        <td>${row[2]}</td>
                        <td>${row[3]}</td>
                        <td>${row[4]}</td>
                        <td>${row[5]}</td>
                        <td>${row[6]}</td>
                        <td>${row[7]}</td>
                    </tr> <br>
                `;
                table.innerHTML += rowHTML;
            });

            table.innerHTML += '</tbody></table>';
        }

        // Function to filter data based on selected district and field
        function filterData() {
            const district = document.getElementById('district').value;
            const field = document.getElementById('field').value;
            const filteredData = studentData.filter(row => {
                const rowDistrict = row[3] ? row[3].toString().trim().toLowerCase() : '';
                const rowField = row[4] ? row[4].toString().trim().toLowerCase() : '';

                let districtMatch = district ? rowDistrict === district.toLowerCase() : true;
                let fieldMatch = field ? rowField.includes(field.toLowerCase()) : true;

                return districtMatch && fieldMatch;
            });

            populateTable(filteredData); // Update the table with filtered data
            updateStatistics(filteredData); // Update statistics based on filtered data
        }

        // Function to populate the district dropdown
        function populateDistricts(data) {
            const districts = [...new Set(data.map(row => row[3]))]; // Extract unique districts
            const districtSelect = document.getElementById('district');
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }
    </script>
</body>
</html>
