<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Development Program</title>
<style>
    /* *{border: 1px solid red;} style debug */
    body {
        font-family: 'Helvetica Neue', Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f5f8;
        color: #333;
    }

    h3 {
        text-align: center;
        font-size: 1.6em;
        margin: 20px 0;
        color: #444;
        font-weight: 600;
    }

    .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
    }

    #statistics {
        background-color: #f7f8fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    #statistics p {
        margin: 10px 0;
        font-size: 1.1em;
        color: #555;
    }

    .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-top: 15px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1em;
    }

    table th, table td {
        padding: 14px;
        border: 1px solid #ddd;
        text-align: left;
        font-weight: 500;
    }

    table th {
        background-color: #4CAF50;
        color: white;
    }

    table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    table tr:hover {
        background-color: #f1f9e6;
    }

    /* Spinning loader animation */
    #loader {
        text-align: center;
        visibility: hidden;
        margin-top: 25px;
        font-size: 18px;
        color: #333;
    }

    #loader.show {
        visibility: visible;
    }

    .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #4CAF50;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 2s linear infinite;
        margin: 0 auto;
    }
    #districtTable{visibility: hidden;}

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /* Footer Styles */
#footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #333;
    color: white;
    text-align: center;
    padding: 5px 0;
    font-size: 14px;
    z-index: 1000;
}

/* Style the footer content */
.footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 10px;
    display: flex;
    justify-content: center;
}

.footer-content p {
    margin: 5px 0;
}

.footer-content a {
    margin: 0 10px;
    display: inline-block;
    color: #4CAF50; /* Green color for links */
    text-decoration: none;
}

a:hover{text-decoration: underline;}


    /* Media Queries for smaller devices */
    @media (max-width: 768px) {
        h3 {
            font-size: 1.4em;
        }

        .container {
            width: 95%;
            padding: 20px;
        }

        table th, table td {
            padding: 12px;
            font-size: 0.9em;
        }

        select {
            width: 100%;
            font-size: 1em;
        }
    }

    @media (max-width: 480px) {
        h3 {
            font-size: 1.2em;
        }

        .container {
            width: 95%;
            padding: 15px;
        }

        table th, table td {
            padding: 10px;
            font-size: 0.8em;
        }

        select {
            width: 40%;
            margin-right: 20px;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        #downloadbtn {
            width: 100%;
        }
    }
</style>

</head>
<body>

    <h3>
        CHIEF MINISTER SKILL DEVELOPMENT AND OVERSEAS EMPLOYMENT PROGRAM<br>
        RECOMMENDED CANDIDATES FOR <br> IT / HEALTH CARE / HOSPITALITY SECTOR AT EU / GERMANY <br>BY 
        RADIUS CONSULTANT
    </h3>

    <div class="container">

        <!-- <a href="overall Result final.xlsx" download="overall Result final.xlsx">
            <button id="downloadbtn" style="padding: 10px 20px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                Download Final Result (Excel)
            </button>
        </a> <hr> -->
        <h3>Female Statistics</h3>
        <span><strong>Total Females:</strong> <span id="Total-Females">0</span></span>
        <span style="margin-left: 20px;"><strong>Fail Females:</strong></strong> <span id="Pass-Females">0</span>
        <div style="margin-top: 10px;" class="search-container">
            <label for="filterInputdistric">Search District:</label>
            <input type="text" id="filterInputdistric" placeholder="Enter district name..." onkeyup="filterDistricts()">
        </div>
        
        <div style="height: 120px; overflow-y: auto; width: 100%; margin-top: 10px;">
        <table id="districtTable">
            <thead>
                <tr>
                    <th>District</th>
                    <th>Total Females</th>
                    <th>Fail Females</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Awaran</td><td>1</td><td>0</td></tr>
                <tr><td>Barkhan</td><td>0</td><td>0</td></tr>
                <tr><td>Chaghi</td><td>0</td><td>0</td></tr>
                <tr><td>Chaman</td><td>2</td><td>1</td></tr>
                <tr><td>Dera Bugti</td><td>0</td><td>0</td></tr>
                <tr><td>GWADER</td><td>0</td><td>0</td></tr>
                <tr><td>Harnai</td><td>0</td><td>0</td></tr>
                <tr><td>HUB</td><td>2</td><td>1</td></tr>
                <tr><td>Jaffarabad</td><td>0</td><td>0</td></tr>
                <tr><td>Jhal Magsi</td><td>0</td><td>0</td></tr>
                <tr><td>Kalat</td><td>2</td><td>2</td></tr>
                <tr><td>Kachhi</td><td>2</td><td>0</td></tr>
                <tr><td>Kech</td><td>1</td><td>0</td></tr>
                <tr><td>Khuzdar</td><td>3</td><td>0</td></tr>
                <tr><td>Killa Abdullah</td><td>0</td><td>0</td></tr>
                <tr><td>Killa Saifullah</td><td>0</td><td>0</td></tr>
                <tr><td>Kohlu</td><td>1</td><td>0</td></tr>
                <tr><td>Lasbella</td><td>0</td><td>0</td></tr>
                <tr><td>Loralai</td><td>0</td><td>0</td></tr>
                <tr><td>Mastung</td><td>2</td><td>0</td></tr>
                <tr><td>Musakhel</td><td>0</td><td>0</td></tr>
                <tr><td>Naseerabad</td><td>1</td><td>0</td></tr>
                <tr><td>Nushki</td><td>2</td><td>0</td></tr>
                <tr><td>Panjgur</td><td>0</td><td>0</td></tr>
                <tr><td>Pishin</td><td>0</td><td>0</td></tr>
                <tr><td>Quetta</td><td>7</td><td>2</td></tr>
                <tr><td>Sibi</td><td>0</td><td>0</td></tr>
                <tr><td>Sohbatpur</td><td>0</td><td>0</td></tr>
                <tr><td>Surab</td><td>1</td><td>1</td></tr>
                <tr><td>Usta Muhammad</td><td>0</td><td>0</td></tr>
                <tr><td>Washuk</td><td>0</td><td>0</td></tr>
                <tr><td>Ziarat</td><td>1</td><td>0</td></tr>
                <tr><td>Kharan</td><td>0</td><td>0</td></tr>
            </tbody>
        </table>
    </div> <hr>
            <!-- Loader -->
        <div id="loader" class="spinner"></div>
    <h3>Overall Statistics</h3>
        <div id="statistics">
            <span><strong>Total Students:</strong> <span id="totalStudents">0</span></span>
            <span style="margin: 0 20px 0 20px;"><strong>Pass:</strong> <span id="passCount">0</span></span>
            <span><strong>Fail:</strong> <span id="failCount">0</span></span>
        </div>
        <h3><img width="20" height="20" src="https://img.icons8.com/fluency/48/filter--v1.png" alt="filter--v1"/>District and Field</h3>

        <select style="margin-bottom: 10px;" id="district" onchange="filterData()">
            <option value="">All Districts</option>
        </select>

        <select id="field" onchange="filterData()">
            <option value="">All Fields</option>
            <option value="IT">IT</option>
            <option value="Health">Health</option>
            <option value="Hospitality">Hospitality</option>
        </select> <br>
        <label>
            <input type="checkbox" id="filterQualified" onchange="filterData()" /> Qualified
        </label>
        <label>
            <input style="margin-bottom: 10px;" type="checkbox" id="filterNotQualified" onchange="filterData()" /> Not Qualified
        </label>

        <span>Search: </span><input type="text" id="searchInput" placeholder="Search by name or NIC" onkeyup="filterTable_main()" />
        <button style="margin-left: 10px;" id="downloadPdfBtn1">Download PDF</button>
        <div class="table-container">
            <table id="resultTable" border="1" style="width: 100%; text-align: left;">
                <!-- Table will be dynamically populated -->
            </table>
            <button style="margin-top: 10px; margin-bottom: 30px;" id="downloadPdfBtn">Download PDF</button>
        </div>

    </div>
<!-- Footer -->
<footer id="footer">
    <div class="footer-content">
        <p>Developed By<a target="_blank" href="https://m-saad.netlify.app/"><strong>M Saad</strong></a></p>
    </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
function filterDistricts() {
    // Get the filter input value
    const filterValue = document.getElementById('filterInputdistric').value.toLowerCase();
    
    // Get the table and its rows
    const table = document.getElementById('districtTable');
    const rows = table.getElementsByTagName('tr');

    // Loop through table rows (start from index 1 to skip the header)
    for (let i = 1; i < rows.length; i++) {
        const districtCell = rows[i].getElementsByTagName('td')[0];
        if (districtCell) {
            // Check if the district matches the filter value
            const districtText = districtCell.textContent || districtCell.innerText;
            if (districtText.toLowerCase().indexOf(filterValue) > -1) {
                rows[i].style.display = ''; // Show the row
            } else {
                rows[i].style.display = 'none'; // Hide the row
            }
        }
    }
}
       // Fetch data on page load
        window.onload = function() {
            fetchData();
        };

        // Function to fetch data from API
        function fetchData() {
            document.getElementById('loader').classList.add('show'); // Show loader

            fetch('https://script.google.com/macros/s/AKfycbwIOjxTdxzCgqNYfPhi4o3rYLDijtxnUWw4jhnZAZ3tFZTkvNZ5KYd8dG39KMmmMmue/exec')
                .then(response => response.json())
                .then(data => {
                    studentData = data;
                    console.log('Fetched data:', studentData[studentData.length-1][8]); 
                    populateTable(studentData); // Populate table with all data
                    updateStatistics(studentData); // Update overall statistics
                    populateDistricts(studentData); // Populate district dropdown
                    document.getElementById('loader').classList.remove('show'); // Hide loader
                    document.getElementById("districtTable").style.visibility = "visible"
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    document.getElementById('loader').classList.remove('show'); // Hide loader
                });
        }

        let totalFemales = 0;
        let passFemales = 0;

        // Function to update overall statistics
        function updateStatistics(data, updateFemales = true) {
            const totalStudents = data.length;
            const passCount = data.filter(row => row[7] >= 50).length; // Assuming column 7 is the final score
            const failCount = totalStudents - passCount;

            // Update main statistics
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;

            // Update Total Females and Pass Females only when updateFemales is true
            if (updateFemales) {
                passFemales = studentData[studentData.length-1][8]; // 'Pass Female' count
                totalFemales = studentData[studentData.length-1][9] // 'Total Female' count

                document.getElementById('Pass-Females').textContent = passFemales;
                document.getElementById('Total-Females').textContent = totalFemales;
            }
        }

    // Populate Table Function
function populateTable(data) {
    const table = document.getElementById('resultTable');
    table.innerHTML = ''; // Clear existing table data

    // Add headers with "Status" column
    const headers = `
        <tr>
            <th>Name</th>
            <th>Father Name</th>
            <th>NIC</th>
            <th>District</th>
            <th>Field</th>
            <th>Status</th>
        </tr>
    `;
    table.innerHTML = headers;

    let rowCount = 0;
    // Populate rows with calculated status
    data.forEach((row, index) => {
        rowCount++;

        const mcqMarks = row[5] || 0;
        const essayMarks = row[6] || 0;
        const totalMarks = mcqMarks + essayMarks;

        let status = '';
        if (totalMarks === 0 || mcqMarks === '' || essayMarks === '') {
            status = 'Absent';
        } else if (totalMarks >= 50) {
            status = 'Qualified';
        } else {
            status = `${totalMarks} Not Qualified`;
        }

        // Add status to the row (for filtering later)
        row.status = status;

        let rowColor = '';
        if (status === 'Absent') {
            rowColor = 'lightgray';
        } else if (status === 'Qualified') {
            rowColor = 'lightgreen';
        } else {
            rowColor = 'lightcoral';
        }

        const rowHTML = `
            <tr style="background-color: ${rowColor};">
                <td>${rowCount} ${row[0]}</td>
                <td>${row[1]}</td>
                <td>${row[2]}</td>
                <td>${row[3]}</td>
                <td>${row[4]}</td>
                <td>${status}</td>
            </tr>
        `;
        table.innerHTML += rowHTML;
    });
}

    // Function to download the table as a PDF
    async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const table = document.getElementById('resultTable');
    const headers = ['Name', 'Father Name', 'NIC', 'District', 'Field', 'Status'];

    // Group rows by district
    const districts = {};
    const allRows = [];
    for (let i = 1; i < table.rows.length; i++) {
        const row = Array.from(table.rows[i].cells).map(cell => cell.textContent);
        allRows.push(row);
        const district = row[3]; // District is the 4th column

        if (!districts[district]) {
            districts[district] = [];
        }
        districts[district].push(row);
    }

    // Prepare summaries
    const districtSummary = [];
    const fieldSummary = {};
    let serialNumber = 1;

    Object.entries(districts).forEach(([district, rows]) => {
        const districtTotalStudents = rows.length;
        const districtAbsentStudents = rows.filter(row => row[5] === 'Absent').length;
        const districtFilteredRows = rows.filter(row => row[5] !== 'Absent');

        let districtTotalPass = 0;
        let districtTotalFail = 0;

        districtFilteredRows.forEach(row => {
            const status = row[5];
            if (status === 'Qualified') districtTotalPass++;
            if (status.includes("Not Qualified")) districtTotalFail++;
        });

        // Add district summary
        districtSummary.push([serialNumber++, district, districtTotalStudents, districtTotalPass, districtTotalFail, districtAbsentStudents]);

        // Add field-wise data for the overall summary
        rows.forEach(row => {
            const field = row[4]; // Field is the 5th column
            const status = row[5]; // Status is the 6th column

            if (!fieldSummary[field]) {
                fieldSummary[field] = { Total: 0, Pass: 0, Fail: 0, Absent: 0 };
            }

            fieldSummary[field].Total++;
            if (status === 'Absent') fieldSummary[field].Absent++;
            else if (status === 'Qualified') fieldSummary[field].Pass++;
            else if (status.includes("Not Qualified")) fieldSummary[field].Fail++;
        });
    });

    // Add overall field and district summary
    doc.setFontSize(16);
    doc.text('Overall Summary', 14, 20);

    // Field Summary
    let yOffset = 30;
    doc.setFontSize(12);
    doc.text('Field-Wise Summary:', 14, yOffset);
    yOffset += 10;

    const fieldSummaryTable = [];
    Object.entries(fieldSummary).forEach(([field, counts]) => {
        fieldSummaryTable.push([field, counts.Total, counts.Pass, counts.Fail, counts.Absent]);
    });

    const fieldSummaryHeaders = ['Field', 'Total Students', 'Pass', 'Fail', 'Absent'];
    doc.autoTable({
        startY: yOffset,
        head: [fieldSummaryHeaders],
        body: fieldSummaryTable,
        styles: {
            fontSize: 10,
            cellPadding: 3,
            halign: 'center',
            valign: 'middle',
        },
        headStyles: { fillColor: [0, 102, 204] },
    });

    // District Summary
    yOffset = doc.autoTable.previous.finalY + 10;
    doc.text('District-Wise Summary:', 14, yOffset);
    yOffset += 10;

    const districtSummaryHeaders = ['Serial No.', 'District', 'Total Students', 'Pass', 'Fail', 'Absent'];
    doc.autoTable({
        startY: yOffset,
        head: [districtSummaryHeaders],
        body: districtSummary,
        styles: {
            fontSize: 10,
            cellPadding: 3,
            halign: 'center',
            valign: 'middle',
        },
        headStyles: { fillColor: [0, 102, 204] },
    });

    // Add district-wise details with field-wise summary on each page
    Object.entries(districts).forEach(([district, rows], index) => {
        doc.addPage(); // Add a new page for each district

        const districtTotalStudents = rows.length;
        const districtAbsentStudents = rows.filter(row => row[5] === 'Absent').length;
        const districtFilteredRows = rows.filter(row => row[5] !== 'Absent');

        let districtTotalPass = 0;
        let districtTotalFail = 0;

        districtFilteredRows.forEach(row => {
            const status = row[5];
            if (status === 'Qualified') districtTotalPass++;
            if (status.includes("Not Qualified")) districtTotalFail++;
        });

        // Add district name and counts at the top
        doc.setFontSize(16);
        doc.text(`District: ${district}`, 14, 20);

        doc.setFontSize(12);
        doc.text(`Total Students: ${districtTotalStudents}`, 14, 30);
        doc.text(`Total Absent: ${districtAbsentStudents}`, 14, 40);
        doc.text(`Total Pass: ${districtTotalPass}`, 14, 50);
        doc.text(`Total Fail: ${districtTotalFail}`, 14, 60);

        // Add the table for the current district
        doc.autoTable({
            startY: 70,
            head: [headers],
            body: rows,
            styles: {
                fontSize: 10,
                cellPadding: 3,
                halign: 'center',
                valign: 'middle',
            },
            headStyles: { fillColor: [0, 102, 204] },
        });

        // Add field-wise Pass and Fail counts for this district
        const fieldCounts = {};
        districtFilteredRows.forEach(row => {
            const field = row[4]; // Field is the 5th column
            const status = row[5]; // Status is the 6th column

            if (!fieldCounts[field]) {
                fieldCounts[field] = { Pass: 0, Fail: 0 };
            }

            if (status === 'Qualified') {
                fieldCounts[field].Pass++;
            } else if (status.includes("Not Qualified")) {
                fieldCounts[field].Fail++;
            }
        });

        yOffset = doc.autoTable.previous.finalY + 10;
        doc.setFontSize(12);
        doc.text('Field-wise Pass and Fail Counts:', 14, yOffset);
        yOffset += 10;

        Object.entries(fieldCounts).forEach(([field, counts]) => {
            doc.text(`${field}: Pass = ${counts.Pass}, Fail = ${counts.Fail}`, 14, yOffset);
            yOffset += 10;
        });
    });

    // Save the PDF
    doc.save('Districts_Report.pdf');
}

// Attach the event listener to the button
document.getElementById('downloadPdfBtn').addEventListener('click', downloadPDF);
document.getElementById('downloadPdfBtn1').addEventListener('click', downloadPDF);

function filterTable_main() {
     // Get the values from the filter checkboxes
    const filterQualified = document.getElementById("filterQualified").checked;
    const filterNotQualified = document.getElementById("filterNotQualified").checked;

    // Get the search input value
    const input = document.getElementById('searchInput');
    const filterText = input.value.toLowerCase();

    const table = document.getElementById('resultTable');
    const rows = table.getElementsByTagName('tr');

    // Loop through each row starting from index 1 to skip the header
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.getElementsByTagName('td');
        const statusCell = cells[5]; // Assuming Status is in the 6th column (index 5)
        
        // Get status text for filter-based check
        let statusText = statusCell ? (statusCell.textContent || statusCell.innerText) : '';

        let shouldShowRow = true;

        // Apply the status-based filters (Qualified/Not Qualified)
        if (filterQualified && statusText !== "Qualified") {
            shouldShowRow = false;
        }
        if (filterNotQualified && !statusText.includes("Not Qualified")) {
            shouldShowRow = false;
        }

        // Apply the search filter (match any cell)
        if (shouldShowRow) {
            let match = false;
            for (let j = 0; j < cells.length; j++) {
                if (cells[j].innerText.toLowerCase().includes(filterText)) {
                    match = true;
                    break;
                }
            }
            shouldShowRow = match; // If a match is found in any cell, the row should be shown
        }

        // Show or hide the row based on both filters
        row.style.display = shouldShowRow ? '' : 'none';
    }
}


        // Function to populate district dropdown
        function populateDistricts(data) {
            const districts = [...new Set(data.map(row => row[3]))]; // Assuming column 3 contains district names
            const districtSelect = document.getElementById('district');
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }

        // Function to filter data based on selected district and field
function filterData() {
    // Get the selected district and field values
    const selectedDistrict = document.getElementById('district').value;
    const selectedField = document.getElementById('field').value;

    // Get the status filter values (Qualified / Not Qualified / Absent)
    const filterQualified = document.getElementById("filterQualified").checked;
    const filterNotQualified = document.getElementById("filterNotQualified").checked;
    const filterAbsent = document.getElementById("filterAbsent").checked; // Add Absent filter

    // Filter the student data by district, field, and status
    const filteredData = studentData.filter(row => {
        const matchesDistrict = selectedDistrict === '' || row[3] === selectedDistrict;
        const matchesField = selectedField === '' || row[4] === selectedField;

        let matchesStatus = true;

        // Apply the status filter based on selected filters
        if (filterQualified && row.status !== 'Qualified') {
            matchesStatus = false;
        }

        if (filterNotQualified && !row.status.includes('Not Qualified')) {
            matchesStatus = false;
        }

        if (filterAbsent && row.status !== 'Absent') {
            matchesStatus = false;
        }

        return matchesDistrict && matchesField && matchesStatus;
    });

    // Populate the table with the filtered data
    populateTable(filteredData);

    // Update the statistics based on the filtered data
    updateStatistics(filteredData, false); // false indicates it's filtered data
}

  </script>

</body>
</html>
